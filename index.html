<!-- â€¦ Keep your <head> and CSS exactly the same â€¦ -->

<body>
<div id="app">
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="card text-center">
            <div style="width: 3rem; height: 3rem; border: 4px solid #4F46E5; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
            <p class="text-gray-600">Loading...</p>
        </div>
    </div>
</div>

<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

<script>
// Globals
let auth, db;
let currentUser = null;
let currentClass = null;
let classes = [];
let deadlines = [];
let posts = [];
let groups = [];
let chatMessages = [];
let currentTab = 'deadlines';

// Firebase init
const firebaseConfig = {
    apiKey: "AIzaSyCfijY0V4DQDOkrb13ludHiGRFtWsk8Bsg",
    authDomain: "student-hub-450ab.firebaseapp.com",
    databaseURL: "https://student-hub-450ab-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "student-hub-450ab",
    storageBucket: "student-hub-450ab.firebasestorage.app",
    messagingSenderId: "149361370872",
    appId: "1:149361370872:web:e3ee75310e59d92f3bbd0d"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
auth = firebase.auth();
db = firebase.database();

// Guest Login Function
function handleGuestLogin() {
    const name = document.getElementById('guest-name').value.trim();
    if (!name) { alert('Please enter a name'); return; }
    currentUser = { id: 'guest-' + Date.now(), name: name };
    render();
}

// UI: Login / Signup / Guest toggles
function showLogin() { toggleTabs('login'); }
function showSignup() { toggleTabs('signup'); }
function showGuest() { toggleTabs('guest'); }

function toggleTabs(tab) {
    document.getElementById('login-tab').className = tab==='login' ? 'btn btn-primary' : 'btn btn-secondary';
    document.getElementById('signup-tab').className = tab==='signup' ? 'btn btn-primary' : 'btn btn-secondary';
    document.getElementById('guest-tab').className = tab==='guest' ? 'btn btn-primary' : 'btn btn-secondary';
    document.getElementById('login-form').style.display = tab==='login' ? 'block':'none';
    document.getElementById('signup-form').style.display = tab==='signup' ? 'block':'none';
    document.getElementById('guest-form').style.display = tab==='guest' ? 'block':'none';
}

// Render Login Page
function renderLogin(){
    return `
    <div style="min-height:100vh; display:flex; align-items:center; justify-content:center; padding:1rem;">
        <div class="card" style="max-width:28rem; width:100%;">
            <div class="text-center mb-4">
                <div class="icon-circle">ðŸ“š</div>
                <h1 style="margin-bottom:0.5rem;">Student Hub</h1>
                <p class="text-gray-600">Collaborate, study, and succeed together</p>
            </div>
            <div class="flex gap-1 mb-2">
                <button onclick="showLogin()" id="login-tab" class="btn btn-primary" style="flex:1;">Login</button>
                <button onclick="showSignup()" id="signup-tab" class="btn btn-secondary" style="flex:1;">Sign Up</button>
                <button onclick="showGuest()" id="guest-tab" class="btn btn-secondary" style="flex:1;">Guest</button>
            </div>
            <div id="login-form">
                <input type="email" id="login-email" placeholder="Email" class="input">
                <input type="password" id="login-password" placeholder="Password" class="input">
                <button onclick="submitLogin()" class="btn btn-primary" style="width:100%;">Login</button>
            </div>
            <div id="signup-form" style="display:none;">
                <input type="text" id="signup-name" placeholder="Full Name" class="input">
                <input type="email" id="signup-email" placeholder="Email" class="input">
                <input type="password" id="signup-password" placeholder="Password" class="input">
                <button onclick="submitSignup()" class="btn btn-primary" style="width:100%;">Sign Up</button>
            </div>
            <div id="guest-form" style="display:none;">
                <input type="text" id="guest-name" placeholder="Enter your name" class="input">
                <button onclick="handleGuestLogin()" class="btn btn-primary" style="width:100%;">Continue as Guest</button>
            </div>
            <p class="text-sm text-gray-600 text-center mt-2">ðŸ”¥ Powered by Firebase</p>
        </div>
    </div>
    `;
}

// Auth Wrappers
function submitLogin() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    auth.signInWithEmailAndPassword(email,password).catch(err=>alert(err.message));
}
function submitSignup() {
    const name = document.getElementById('signup-name').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    auth.createUserWithEmailAndPassword(email,password)
        .then(cred => cred.user.updateProfile({displayName:name}))
        .catch(err=>alert(err.message));
}
function handleLogout() { currentUser=null; currentClass=null; classes=[]; deadlines=[]; posts=[]; groups=[]; chatMessages=[]; render(); }

// Main Render Function
function render(){
    const app = document.getElementById('app');
    if(!currentUser) app.innerHTML = renderLogin();
    else if(!currentClass) app.innerHTML = renderClassSelection();
    else app.innerHTML = renderMainApp();
}

// Initial Firebase Auth Listener
auth.onAuthStateChanged(user=>{
    if(user){
        currentUser={id:user.uid, email:user.email, name:user.displayName||user.email.split('@')[0]};
        loadUserClasses();
    } else {
        currentUser=null; render();
    }
});

// ----- Keep all other functions (loadUserClasses, loadClassData, renderClassSelection, renderMainApp, etc.) exactly the same as your current code -----
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Your existing <head> content unchanged -->
</head>
<body>
    <div id="app">
        <!-- Loading spinner unchanged -->
    </div>

    <style>
        /* Your existing styles unchanged */
    </style>

<script>
// ---- Updated JS with Guest Mode Support ----

// Globals
let auth, db;
let currentUser = null;
let currentClass = null;
let classes = [];
let deadlines = [];
let posts = [];
let groups = [];
let chatMessages = [];
let currentTab = 'deadlines';

const GUEST_UID = 'guest-user-0001'; // Fixed UID for all guests (data shared, simple)

// Utility: show a simple error screen
function showError(message) {
    document.getElementById('app').innerHTML = 
        '<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem;">' +
        '<div class="card text-center" style="max-width: 28rem;">' +
        '<h2 style="color: #DC2626; margin-bottom: 1rem;">Error</h2>' +
        '<p class="text-gray-600 mb-2">' + message + '</p>' +
        '<button onclick="location.reload()" class="btn btn-primary mt-2">Refresh</button>' +
        '</div></div>';
}

// Generate random guest name
function generateGuestName() {
    const adjectives = ['Quick','Smart','Brave','Clever','Happy','Cool','Wise','Bold','Calm','Bright','Swift','Keen','Sharp','Neat','Kind'];
    const animals = ['Fox','Bear','Lion','Wolf','Eagle','Shark','Panda','Tiger','Owl','Hawk','Deer','Cat','Dog','Rabbit','Koala'];
    const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
    const animal = animals[Math.floor(Math.random() * animals.length)];
    const num = Math.floor(Math.random() * 900) + 100; // 100-999
    return `${adj}${animal}${num}`;
}

// Guest login handler
function continueAsGuest() {
    const guestName = generateGuestName();
    currentUser = { id: GUEST_UID, name: guestName, email: 'guest@example.com', isGuest: true };
    loadUserClasses();
    render();
    alert(`Welcome, ${guestName}! You're browsing as a guest.`);
}

// Firebase listeners (unchanged)
function loadUserClasses() {
    if (!currentUser || !db) return;
    db.ref('users/' + currentUser.id + '/classes').on('value', function(snapshot) {
        var data = snapshot.val();
        classes = data ? Object.values(data) : [];
        render();
    });
}

// ... (All other functions like loadClassData, createClass, joinWithCode, addDeadline, etc. remain EXACTLY the same)

// Render updates - only login screen changed
function renderLogin(){
    return '<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem;">' +
        '<div class="card" style="max-width: 28rem; width: 100%;">' +
        '<div class="text-center mb-4"><div class="icon-circle">ðŸ“š</div><h1 style="margin-bottom: 0.5rem;">Student Hub</h1><p class="text-gray-600">Collaborate, study, and succeed together</p></div>' +
        '<div class="flex gap-1 mb-2">' +
        '<button onclick="showLogin()" id="login-tab" class="btn btn-primary" style="flex: 1;">Login</button>' +
        '<button onclick="showSignup()" id="signup-tab" class="btn btn-secondary" style="flex: 1;">Sign Up</button>' +
        '</div>' +
        '<div id="login-form">' +
        '<input type="email" id="login-email" placeholder="Email" class="input">' +
        '<input type="password" id="login-password" placeholder="Password" class="input">' +
        '<button onclick="submitLogin()" class="btn btn-primary" style="width: 100%;">Login</button>' +
        '</div>' +
        '<div id="signup-form" style="display:none;">' +
        '<input type="text" id="signup-name" placeholder="Full Name" class="input">' +
        '<input type="email" id="signup-email" placeholder="Email" class="input">' +
        '<input type="password" id="signup-password" placeholder="Password (min 6 characters)" class="input">' +
        '<button onclick="submitSignup()" class="btn btn-primary" style="width: 100%;">Sign Up</button>' +
        '</div>' +
        '<div class="mt-2 text-center">' +
        '<button onclick="continueAsGuest()" class="btn btn-secondary" style="width: 100%;">Continue as Guest</button>' +
        '</div>' +
        '<p class="text-sm text-gray-600 text-center mt-2">ðŸ”¥ Powered by Firebase</p>' +
        '</div></div>';
}

// Initialize firebase + auth
window.addEventListener('load', function(){
    if (typeof firebase === 'undefined') { showError('Firebase failed to load. Please refresh the page.'); return; }
    const firebaseConfig = {
        apiKey: "AIzaSyCfijY0V4DQDOkrb13ludHiGRFtWsk8Bsg",
        authDomain: "student-hub-450ab.firebaseapp.com",
        databaseURL: "https://student-hub-450ab-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "student-hub-450ab",
        storageBucket: "student-hub-450ab.firebasestorage.app",
        messagingSenderId: "149361370872",
        appId: "1:149361370872:web:e3ee75310e59d92f3bbd0d"
    };

    try {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.database();

        auth.onAuthStateChanged(function(user){
            if (user) {
                currentUser = { id: user.uid, email: user.email, name: user.displayName || user.email.split('@')[0] };
                loadUserClasses();
            } else {
                // Not logged in - show login screen (guest can bypass)
                currentUser = null;
                render();
            }
        });
        render();
    } catch (e) { showError('Failed to initialize: ' + e.message); }
});

</script>
</body>
</html>